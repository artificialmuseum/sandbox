function t(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function e(e){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?t(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(t,e,i,r,n,o,a){try{var s=t[o](a),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(r,n)}function r(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function s(t){i(a,n,o,s,c,"next",t)}function c(t){i(a,n,o,s,c,"throw",t)}s(void 0)}))}}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){if(null==t)return{};var i,r,n=function(t,e){if(null==t)return{};var i,r,n={},o=Object.keys(t);for(r=0;r<o.length;r++)i=o[r],e.indexOf(i)>=0||(n[i]=t[i]);return n}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)i=o[r],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}var a=(t,e)=>"function"==typeof a[e]?a[e](t):typeof t===e;a.fn=t=>"function"==typeof t,a.str=t=>"string"==typeof t,a.obj=t=>"object"==typeof t,a.arr=t=>Array.isArray(t),a.bool=t=>"boolean"==typeof t,a.num=t=>t===+t;var s=window;s.D=document,s.B=s.D.body,s.M=Math,s.NAV=s.navigator,s.UA=s.NAV.userAgent.toLowerCase()||"",s.URL=s.URL||s.webkitURL,s.store=new class{constructor(t){var{W:e,type:i="session"}=t;try{var r=e["".concat(i,"Storage")],n="random-".concat(M.random());r.setItem(n,n),r.removeItem(n),this.store=r}catch(t){this.store={}}}setItem(t,e){var i=["setItem","getItem","removeItem"],r=i.indexOf(t);if(r>-1)throw new Error("can not overwrite store.".concat(i[r],", it's a builtin"));var n=JSON.stringify(e);return this.store[t]=n,!0}getItem(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this.store.hasOwnProperty(t)?JSON.parse(this.store[t]):e}removeItem(t){a.fn(this.store.removeItem)?this.store.removeItem(t):delete this.store[t]}clear(){a.fn(this.store.clear)?this.store.clear():this.store={}}}({W:s,type:"session"});var c=["className","id","innerText","children","on","parent","style"],h=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{parent:i=s.D,single:r=!1}=e,n=t.split(" "),o=n[n.length-1];return r||o.startsWith("#")?i.querySelector(t):Array.from(i.querySelectorAll(t))};h.show=(t,e)=>{t&&(a.str(t)&&(t=h(t,e)),a.arr(t)?t.forEach((t=>h.show(t,e))):t.classList&&t.classList.add("visible"))},h.hide=(t,e)=>{t&&(a.arr(t)?t.forEach((t=>h.hide(t,e))):(a.str(t)&&(t=h(t,e)),t.classList&&t.classList.remove("visible")))},h.prop=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.str(t)&&(t=h(t)),Object.entries(e).forEach((e=>{var[i,r]=e;!1===r?t.removeAttribute(i):t.setAttribute(i,r)}))},h.create=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{className:i,id:r,innerText:n,children:l,on:d,parent:u,style:f}=e,m=o(e,c),b=s.D.createElement(t);i&&(b.className=i),n&&(b.innerText=n),l&&(a.str(l)?b.innerText+=l:a.arr(l)&&l.forEach((t=>b.appendChild(t)))),f&&Object.entries(f).forEach((t=>{var[e,i]=t;b.style[e]=i})),r&&b.setAttribute("id",r),d&&Object.entries(d).forEach((t=>{var[e,i]=t;b.addEventListener(e,i)})),u&&h.append(b,u);var v=Object.entries(m);return v.length&&v.map((t=>{var[e,i]=t;b.setAttribute(e,i)})),b},h.on=function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};a.str(t)&&(t=h(t)),a.arr(t)?t.forEach((t=>t.addEventListener(e,i,!1,r))):t.addEventListener(e,i,!1,r)},h.off=(t,e,i,r)=>{a.str(t)&&(t=h(t)),a.arr(t)?t.forEach((t=>t.removeEventListener(e,i,!1,r))):t.removeEventListener(e,i,!1,r)},h.append=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B;a.str(t)&&(t=h(t)),a.str(e)&&(e=h(e)),e&&t&&(a.arr(t)?t.forEach((t=>e.appendChild(t))):e.appendChild(t))},h.remove=t=>{t&&(a.str(t)&&(t=h(t)),t&&t.parentNode&&t.parentNode.removeChild(t))};var l=s.UA,d=l.includes("mac")&&"ontouchend"in s.D,u=["ipad","iphone","ipod"].some((t=>l.includes(t)))||d;!u&&l.includes("macintosh"),l.includes("applewebkit")&&l.includes("safari")&&l.includes("crios");var f=(()=>{var t;if(l.includes("chrome/")?t=l.split("chrome/")[1]:l.includes("samsungbrowser/")&&(t=l.split("samsungbrowser/")[1]),t){t=t.split(".")[0];var e=parseInt(t,10);if(a.num(e))return e}})(),m=a.num(f),b=l.includes("android"),v=u&&l.includes("webxrviewer"),w=function(){var t=r((function*(){try{return yield s.NAV.xr.isSessionSupported("immersive-ar")}catch(t){}return!1}));return function(){return t.apply(this,arguments)}}(),p=()=>{try{var t=h.create("canvas");return!(!s.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},g=()=>{try{var t=h.create("canvas");return!(!s.WebGL2RenderingContext||!t.getContext("webgl2"))}catch(t){return!1}},_=function(){var t=r((function*(){return{XR:yield w(),WEBGL:p(),WEBGL2:g(),WEBP:yield new Promise((t=>{var e=new Image;e.onload=()=>{var i=e.width>0&&e.height>0;t(i)},e.onerror=()=>{t(!1)},e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAA"}))}}));return function(){return t.apply(this,arguments)}}(),y=1,C=7,k={requiredFeatures:["hit-test","dom-overlay"]},A={fov:60,near:.01,far:500},O={maxDistance:70,minDistance:5,maxPolarAngle:Math.PI/1.9,enablePan:!1},D={ambientColor:16777215,ambientIntensity:.5,directionalColor:16777215,directionalIntensity:2.5,directionalPosition:[20,40,10]},P=.2,T=[100,60,40],F="skybox",E="three-running",j={x:0,y:7,z:12},x="three-audio",I="three-video",S="three-canvas",L="three-container",R="hud",W="hud-exit-button";class N{constructor(){this.isAndroidChrome=b&&m,this._warningContainer=h("#timeout-warning"),this._header=h("#timeout-warning-header"),this._headerDone=h("#timeout-warning-header-done"),this._preloadInfo=h("#timeout-warning-info"),this._cancelButton=h("#timeout-warning-cancel"),this._confirmButton=h("#timeout-warning-confirm"),this._tooFarContainer=h("#toofar-warning"),this._tooFarPreviewButton=h("#toofar-warning-load-preview-button"),this._tooFarDistanceInfo=h("#toofar-warning-distance"),this._tooFarCancelButton=h("#toofar-warning-cancel-button"),this._tooFarAbortButton=h("#toofar-warning-abort-button"),this._webglDisabledContainer=h("#timeout-warning-webgl-disabled"),this._webglDisabledOkButton=h("#timeout-warning-webgl-disabled-ok-button"),this.confirmButtonClickHandler=this.confirmButtonClickHandler.bind(this),h.on(this._confirmButton,"click",this.confirmButtonClickHandler),this.onTooFarCancelButtonClick=this.onTooFarCancelButtonClick.bind(this),this.onTooFarPreviewButtonClick=this.onTooFarPreviewButtonClick.bind(this),this.onWebglDisabledOkButtonClick=this.onWebglDisabledOkButtonClick.bind(this),this.startThree=this.startThree.bind(this)}init(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{artifact:e,hooks:i,XR:r}=t;this._isWorking=!0,this._isCancelled=!1,this._session=!1,this.artifact=e,this.XR=r,this.hooks=i,h.on(this._cancelButton,"click",(()=>{this._isCancelled=!0,this.finished()})),h.show([this._warningContainer,this._header]),this.timeout=s.setTimeout(this.showTimeoutWarning,1e4)}startThree(){var t=this;return r((function*(){var{artifact:e,hooks:i,XR:r}=t,{Three:n}=yield import("./three.js"),o=new n({artifact:e,hooks:i,preload:t,XR:r}),a=yield o.init();if(!a)throw new Error("Session undefined.");t.loadDone(a)}))()}showTimeoutWarning(){h.show(this._preloadInfo),this.isAndroidChrome&&(h.show(this._confirmButton),this._confirmButton.setAttribute("disabled",!0),this._timeoutShown=!0)}confirmButtonClickHandler(){var t=this;return r((function*(){t._session&&(yield t.finishLoad(),t.finished())}))()}loadDone(t){h.hide(this._header),h.hide(this._preloadInfo),h.show(this._headerDone),this._session=t,this._timeoutShown&&this.isAndroidChrome?h.prop(this._confirmButton,{disabled:!1}):this._isCancelled||this.finishLoad()}finishLoad(){var t=this;return r((function*(){if(t._session){var{hud:e,initFallbackSession:i,initScene:r}=t._session;try{yield r(),e.show(),h.show("#".concat("three-container")),t.finished()}catch(r){"InvalidStateError"===r.name||"NotSupportedError"===r.name?(yield i(),e.show(),h.show("#".concat("three-container")),t.finished()):"SecurityError"===r.name?(h.show(t._confirmButton),h.prop(t._confirmButton,{disabled:!1})):console.error("Unexpected Preload.finishLoad error",r.name,r.message)}}}))()}setError(t,e){console.warn(t,e),s.clearTimeout(this.timeout),this.finished()}showTooFarNotification(t){var{distance:e,artifact:i}=t,r="meter",n=e;n>=1e3?(r="kilometer",n>=2e3&&(r+="s"),n=Math.round(n/1e3)):n>=2&&(r+="s"),this.artifact=i,this._header=h("#timeout-warning-header"),this._headerDone=h("#timeout-warning-header-done"),this._preloadInfo=h("#timeout-warning-info"),this._cancelButton=h("#timeout-warning-cancel"),this._confirmButton=h("#timeout-warning-confirm"),this.XR=!1,this._tooFarDistanceInfo.innerText="This artifact is ".concat(n," ").concat(r," away."),h.show(this._tooFarContainer),h.on(this._tooFarPreviewButton,"click",this.onTooFarPreviewButtonClick),h.on(this._tooFarCancelButton,"click",this.onTooFarCancelButtonClick),h.on(this._tooFarAbortButton,"click",this.onTooFarCancelButtonClick)}onTooFarCancelButtonClick(){h.off(this._tooFarPreviewButton,"click",this.onTooFarPreviewButtonClick),this._isCancelled=!0,h.hide(this._tooFarContainer),this.finished()}onTooFarPreviewButtonClick(){var t=this;return r((function*(){h.off(t._tooFarPreviewButton,"click",t.onTooFarPreviewButtonClick),h.off(t._tooFarCancelButton,"click",t.onTooFarCancelButtonClick),h.off(t._tooFarAbortButton,"click",t.onTooFarCancelButtonClick),h.hide(t._tooFarContainer);var{artifact:e,XR:i}=t;t.init({artifact:e,XR:i}),yield t.startThree()}))()}showWebglDisabledNotification(){h.show(this._webglDisabledContainer),h.hide([this._header,this._headerDone,this._preloadInfo,this._cancelButton,this._confirmButton]),h.on(this._webglDisabledOkButton,"click",this.onWebglDisabledOkButtonClick)}onWebglDisabledOkButtonClick(){h.off(this._webglDisabledOkButton,"click",this.onWebglDisabledOkButtonClick),this._isCancelled=!0,h.hide(this._webglDisabledContainer),this.finished()}finished(){this._isWorking=!1,this._timeoutShown=!1,h(".start-experience-button").forEach((t=>{t.removeAttribute("disabled")})),h.hide([this._warningContainer,this._confirmButton,this._preloadInfo,this._headerDone]),h.prop(this._confirmButton,{disabled:!0}),h.show(this._header),s.clearTimeout(this.timeout)}}var X=!1,U=t=>{var{artifact:e,hooks:i,XR:n=!1}=t;return function(){var t=r((function*(t){X||(X=new N);var r=h("#show-artifact");r.disabled=!0;try{X._isWorking||(X.init({artifact:e,hooks:i,XR:n}),yield X.startThree(),r.disabled=!1)}catch(t){var o=t.toString().toLowerCase();o.includes("error creating webgl context")?X.showWebglDisabledNotification():console.error("onButtonClick: preload.init failed",t)}}));return function(e){return t.apply(this,arguments)}}()};(function(){var t=r((function*(){s.SUPPORTS=yield _();var{default:t}=yield import("../../../../../../../artifact/artifact.js"),{default:e}=yield import("../../../../../../../artifact/render.js"),{default:i}=yield import("../../../../../../../artifact/init.js"),r={init:i,render:e},{XR:n}=s.SUPPORTS,o=h("#show-artifact");h.on(o,"click",U({artifact:t,hooks:r,XR:n})),v&&h("a").forEach((t=>{t.removeAttribute("target")}))}));return function(){return t.apply(this,arguments)}})()();export{h as $,y as V,s as W,r as _,x as a,S as b,E as c,R as d,W as e,A as f,e as g,T as h,a as i,F as j,u as k,D as l,C as m,O as o,j as p,P as s,L as t,I as v,v as w,k as x};
