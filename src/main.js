function t(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function e(e){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?t(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(t,e,i,r,n,o,a){try{var s=t[o](a),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(r,n)}function r(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function s(t){i(a,n,o,s,c,"next",t)}function c(t){i(a,n,o,s,c,"throw",t)}s(void 0)}))}}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){if(null==t)return{};var i,r,n=function(t,e){if(null==t)return{};var i,r,n={},o=Object.keys(t);for(r=0;r<o.length;r++)i=o[r],e.indexOf(i)>=0||(n[i]=t[i]);return n}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)i=o[r],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function a(t){throw new TypeError('"'+t+'" is read-only')}var s=(t,e)=>"function"==typeof s[e]?s[e](t):typeof t===e;s.fn=t=>"function"==typeof t,s.str=t=>"string"==typeof t,s.obj=t=>"object"==typeof t,s.arr=t=>Array.isArray(t),s.bool=t=>"boolean"==typeof t,s.num=t=>t===+t;var c=window;c.D=document,c.B=c.D.body,c.M=Math,c.NAV=c.navigator,c.UA=c.NAV.userAgent.toLowerCase()||"",c.URL=c.URL||c.webkitURL,c.store=new class{constructor(t){var{W:e,type:i="session"}=t;try{var r=e["".concat(i,"Storage")],n="random-".concat(M.random());r.setItem(n,n),r.removeItem(n),this.store=r}catch(t){this.store={}}}setItem(t,e){var i=["setItem","getItem","removeItem"],r=i.indexOf(t);if(r>-1)throw new Error("can not overwrite store.".concat(i[r],", it's a builtin"));var n=JSON.stringify(e);return this.store[t]=n,!0}getItem(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this.store.hasOwnProperty(t)?JSON.parse(this.store[t]):e}removeItem(t){s.fn(this.store.removeItem)?this.store.removeItem(t):delete this.store[t]}clear(){s.fn(this.store.clear)?this.store.clear():this.store={}}}({W:c,type:"session"});var h=["className","id","innerText","children","on","parent","style"],l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{parent:i=c.D,single:r=!1}=e,n=t.split(" "),o=n[n.length-1];return r||o.startsWith("#")?i.querySelector(t):Array.from(i.querySelectorAll(t))};l.show=(t,e)=>{t&&(s.str(t)&&(t=l(t,e)),s.arr(t)?t.forEach((t=>l.show(t,e))):t.classList&&t.classList.add("visible"))},l.hide=(t,e)=>{t&&(s.arr(t)?t.forEach((t=>l.hide(t,e))):(s.str(t)&&(t=l(t,e)),t.classList&&t.classList.remove("visible")))},l.prop=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.str(t)&&(t=l(t)),Object.entries(e).forEach((e=>{var[i,r]=e;!1===r?t.removeAttribute(i):t.setAttribute(i,r)}))},l.create=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{className:i,id:r,innerText:n,children:a,on:u,parent:d,style:f}=e,m=o(e,h),b=c.D.createElement(t);i&&(b.className=i),n&&(b.innerText=n),a&&(s.str(a)?b.innerText+=a:s.arr(a)&&a.forEach((t=>b.appendChild(t)))),f&&Object.entries(f).forEach((t=>{var[e,i]=t;b.style[e]=i})),r&&b.setAttribute("id",r),u&&Object.entries(u).forEach((t=>{var[e,i]=t;b.addEventListener(e,i)})),d&&l.append(b,d);var v=Object.entries(m);return v.length&&v.map((t=>{var[e,i]=t;b.setAttribute(e,i)})),b},l.on=function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};s.str(t)&&(t=l(t)),s.arr(t)?t.forEach((t=>t.addEventListener(e,i,!1,r))):t.addEventListener(e,i,!1,r)},l.off=(t,e,i,r)=>{s.str(t)&&(t=l(t)),s.arr(t)?t.forEach((t=>t.removeEventListener(e,i,!1,r))):t.removeEventListener(e,i,!1,r)},l.append=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B;s.str(t)&&(t=l(t)),s.str(e)&&(e=l(e)),e&&t&&(s.arr(t)?t.forEach((t=>e.appendChild(t))):e.appendChild(t))},l.remove=t=>{t&&(s.str(t)&&(t=l(t)),t&&t.parentNode&&t.parentNode.removeChild(t))};var u=c.UA,d=u.includes("mac")&&"ontouchend"in c.D,f=["ipad","iphone","ipod"].some((t=>u.includes(t)))||d;!f&&u.includes("macintosh"),u.includes("applewebkit")&&u.includes("safari")&&u.includes("crios");var m=(()=>{var t;if(u.includes("chrome/")?t=u.split("chrome/")[1]:u.includes("samsungbrowser/")&&(t=u.split("samsungbrowser/")[1]),t){t=t.split(".")[0];var e=parseInt(t,10);if(s.num(e))return e}})(),b=s.num(m),v=u.includes("android"),w=f&&u.includes("webxrviewer"),p=function(){var t=r((function*(){try{return yield c.NAV.xr.isSessionSupported("immersive-ar")}catch(t){}return!1}));return function(){return t.apply(this,arguments)}}(),g=()=>{try{var t=l.create("canvas");return!(!c.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},_=()=>{try{var t=l.create("canvas");return!(!c.WebGL2RenderingContext||!t.getContext("webgl2"))}catch(t){return!1}},y=function(){var t=r((function*(){return{XR:yield p(),WEBGL:g(),WEBGL2:_(),WEBP:yield new Promise((t=>{var e=new Image;e.onload=()=>{var i=e.width>0&&e.height>0;t(i)},e.onerror=()=>{t(!1)},e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAA"}))}}));return function(){return t.apply(this,arguments)}}(),C=1,k=7,A={requiredFeatures:["hit-test","dom-overlay"]},O={fov:60,near:.01,far:500},D={maxDistance:70,minDistance:5,maxPolarAngle:Math.PI/1.9,enablePan:!1},P={ambientColor:16777215,ambientIntensity:.5,directionalColor:16777215,directionalIntensity:2.5,directionalPosition:[20,40,10]},T=.2,F=[100,60,40],E="skybox",x="three-running",I={x:0,y:7,z:12},S="three-audio",j="three-video",L="three-canvas",R="three-container",W="hud",N="hud-exit-button";class X{constructor(){this.isAndroidChrome=v&&b,this._warningContainer=l("#timeout-warning"),this._header=l("#timeout-warning-header"),this._headerDone=l("#timeout-warning-header-done"),this._preloadInfo=l("#timeout-warning-info"),this._cancelButton=l("#timeout-warning-cancel"),this._confirmButton=l("#timeout-warning-confirm"),this._tooFarContainer=l("#toofar-warning"),this._tooFarPreviewButton=l("#toofar-warning-load-preview-button"),this._tooFarDistanceInfo=l("#toofar-warning-distance"),this._tooFarCancelButton=l("#toofar-warning-cancel-button"),this._tooFarAbortButton=l("#toofar-warning-abort-button"),this._webglDisabledContainer=l("#timeout-warning-webgl-disabled"),this._webglDisabledOkButton=l("#timeout-warning-webgl-disabled-ok-button"),this.confirmButtonClickHandler=this.confirmButtonClickHandler.bind(this),l.on(this._confirmButton,"click",this.confirmButtonClickHandler),this.onTooFarCancelButtonClick=this.onTooFarCancelButtonClick.bind(this),this.onTooFarPreviewButtonClick=this.onTooFarPreviewButtonClick.bind(this),this.onWebglDisabledOkButtonClick=this.onWebglDisabledOkButtonClick.bind(this),this.startThree=this.startThree.bind(this)}init(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{artifact:e,map:i,XR:r}=t;this._isWorking=!0,this._isCancelled=!1,this._session=!1,this.artifact=e,this.map=i,this.XR=r,l.on(this._cancelButton,"click",(()=>{this._isCancelled=!0,this.finished()})),l.show([this._warningContainer,this._header]),this.timeout=c.setTimeout(this.showTimeoutWarning,1e4)}startThree(){var t=this;return r((function*(){var{artifact:e,map:i,XR:r}=t,{Three:n}=yield import("./three.js"),o=new n({artifact:e,map:i,preload:t,XR:r}),a=yield o.init();if(!a)throw new Error("Session undefined.");t.loadDone(a)}))()}showTimeoutWarning(){l.show(this._preloadInfo),this.isAndroidChrome&&(l.show(this._confirmButton),this._confirmButton.setAttribute("disabled",!0),this._timeoutShown=!0)}confirmButtonClickHandler(){var t=this;return r((function*(){t._session&&(yield t.finishLoad(),t.finished())}))()}loadDone(t){l.hide(this._header),l.hide(this._preloadInfo),l.show(this._headerDone),this._session=t,this._timeoutShown&&this.isAndroidChrome?l.prop(this._confirmButton,{disabled:!1}):this._isCancelled||this.finishLoad()}finishLoad(){var t=this;return r((function*(){if(t._session){var{hud:e,initFallbackSession:i,initScene:r}=t._session;try{yield r(),e.show(),l.show("#".concat("three-container")),t.finished()}catch(r){"InvalidStateError"===r.name||"NotSupportedError"===r.name?(yield i(),e.show(),l.show("#".concat("three-container")),t.finished()):"SecurityError"===r.name?(l.show(t._confirmButton),l.prop(t._confirmButton,{disabled:!1})):console.error("Unexpected Preload.finishLoad error",r.name,r.message)}}}))()}setError(t,e){console.warn(t,e),c.clearTimeout(this.timeout),this.finished()}showTooFarNotification(t){var{distance:e,artifact:i,map:r}=t,n="meter",o=e;o>=1e3?(n="kilometer",o>=2e3&&(n+="s"),o=Math.round(o/1e3)):o>=2&&(n+="s"),this.artifact=i,this.map=r,this._header=l("#timeout-warning-header"),this._headerDone=l("#timeout-warning-header-done"),this._preloadInfo=l("#timeout-warning-info"),this._cancelButton=l("#timeout-warning-cancel"),this._confirmButton=l("#timeout-warning-confirm"),this.XR=!1,this._tooFarDistanceInfo.innerText="This artifact is ".concat(o," ").concat(n," away."),l.show(this._tooFarContainer),l.on(this._tooFarPreviewButton,"click",this.onTooFarPreviewButtonClick),l.on(this._tooFarCancelButton,"click",this.onTooFarCancelButtonClick),l.on(this._tooFarAbortButton,"click",this.onTooFarCancelButtonClick)}onTooFarCancelButtonClick(){l.off(this._tooFarPreviewButton,"click",this.onTooFarPreviewButtonClick),this._isCancelled=!0,l.hide(this._tooFarContainer),this.finished()}onTooFarPreviewButtonClick(){var t=this;return r((function*(){l.off(t._tooFarPreviewButton,"click",t.onTooFarPreviewButtonClick),l.off(t._tooFarCancelButton,"click",t.onTooFarCancelButtonClick),l.off(t._tooFarAbortButton,"click",t.onTooFarCancelButtonClick),l.hide(t._tooFarContainer);var{artifact:e,map:i,XR:r}=t;t.init({artifact:e,map:i,XR:r}),yield t.startThree()}))()}showWebglDisabledNotification(){l.show(this._webglDisabledContainer),l.hide([this._header,this._headerDone,this._preloadInfo,this._cancelButton,this._confirmButton]),l.on(this._webglDisabledOkButton,"click",this.onWebglDisabledOkButtonClick)}onWebglDisabledOkButtonClick(){l.off(this._webglDisabledOkButton,"click",this.onWebglDisabledOkButtonClick),this._isCancelled=!0,l.hide(this._webglDisabledContainer),this.finished()}finished(){this._isWorking=!1,this._timeoutShown=!1,l(".start-experience-button").forEach((t=>{t.removeAttribute("disabled")})),l.hide([this._warningContainer,this._confirmButton,this._preloadInfo,this._headerDone]),l.prop(this._confirmButton,{disabled:!0}),l.show(this._header),c.clearTimeout(this.timeout)}}var U=!1,G=t=>{var{artifact:e,XR:i=!1}=t;return function(){var t=r((function*(t){U||(U=new X);var r=l("#show-artifact");r.disabled=!0;try{U._isWorking||(U.init({artifact:e,XR:i}),yield U.startThree(),r.disabled=!1)}catch(t){var n=t.toString().toLowerCase();n.includes("error creating webgl context")?U.showWebglDisabledNotification():console.error("onButtonClick: preload.init failed",t)}}));return function(e){return t.apply(this,arguments)}}()};(function(){var t=r((function*(){c.SUPPORTS=yield y();var{XR:t}=c.SUPPORTS,e=l("#show-artifact"),{default:i}=yield import("../../../../../../../artifact/artifact.js");l.on(e,"click",G({artifact:i,XR:t})),w&&l("a").forEach((t=>{t.removeAttribute("target")}))}));return function(){return t.apply(this,arguments)}})()();export{l as $,C as V,c as W,r as _,N as a,S as b,n as c,O as d,L as e,R as f,e as g,a as h,s as i,x as j,F as k,P as l,k as m,E as n,D as o,f as p,I as q,T as s,W as t,j as v,w,A as x};
